<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DPMM">
<title>Worked Examples • DPMM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Worked Examples">
<meta property="og:description" content="DPMM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DPMM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/DPMM.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Worked_Examples.html">Worked Examples</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/PM-Cardoso/DPMM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Worked Examples</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PM-Cardoso/DPMM/blob/HEAD/vignettes/Worked_Examples.Rmd" class="external-link"><code>vignettes/Worked_Examples.Rmd</code></a></small>
      <div class="d-none name"><code>Worked_Examples.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The goal of <code>DPMM</code> is to fit a Dirichlet Process Mixture
Model to a dataset with continuous and/or categorical predictors. The
fitted model can be used for prediction of missing predictors.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DPMM</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>In this file, we will analyse several datasets and show the
capability of this package.</p>
</div>
<div class="section level2">
<h2 id="dataset-1">Dataset 1<a class="anchor" aria-label="anchor" href="#dataset-1"></a>
</h2>
<p>Dataset 1 is comprised of two distinct clusters, where the values of
both predictor variables do not overlap each other. Therefore, one
variable is informative of the other.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dataset_1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="va">dataset_1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<div class="section level3">
<h3 id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h3>
<p>We can fit the DPMM to the complete dataset. The ‘mcmc_iterations’
represents how long the MCMC chain should run (longer is better), ‘L’
represents the number of clusters that should be fitted, ‘mcmc_chain’
represents the number of MCMC chains being fitted in this function and
‘standardise’ chooses whether the continuous values should be
standardised.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_1</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       mcmc_chains <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, tauL, v, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; conjugate sampler (17)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (1000 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>We can check the fit of the DPMM to ensure that random samples from
the fitted DPMM are in the same covariate space as the original
data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ggpairs.html">plot_ggpairs</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>             newdata <span class="op">=</span> <span class="va">dataset_1</span>, </span>
<span>             nburn <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>We can introduce missingness in the dataset and check whether the
DPMM is predicting values in the right cluster. In this case, we
introduce missingness in ‘X1’ for some of the patients in one of the
clusters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span></span>
<span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_1</span></span>
<span><span class="va">dataset_missing_predict</span> <span class="op">&lt;-</span> <span class="va">dataset_missing</span><span class="op">[</span><span class="va">rows</span>,<span class="op">]</span></span>
<span><span class="va">dataset_missing_predict</span><span class="op">[</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p>And make predictions from the fitted DPMM.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors.prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_dpmm_fit.html">predict_dpmm_fit</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>                                          newdata <span class="op">=</span> <span class="va">dataset_missing_predict</span>,</span>
<span>                                          samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1500</span>,<span class="fl">2500</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can then check whether the values are being predicted in the right
place. First, we calculate the credible intervals for each predicted
value.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">low_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">median_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">high_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">low_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">low_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">median_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">median_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">high_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">high_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We then standardise the original values to match the standardisation
in the DPMM.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">standardised_values</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">dataset_missing</span><span class="op">[</span><span class="va">rows</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">-</span><span class="va">posteriors</span><span class="op">$</span><span class="va">mean_values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">posteriors</span><span class="op">$</span><span class="va">sd_values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>Lastly, we plot the credible intervals against the true values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">standardised_values</span>,<span class="va">low_q</span>, <span class="va">median_q</span>,<span class="va">high_q</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observed"</span>, <span class="st">"low"</span>,<span class="st">"median"</span>,<span class="st">"high"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, y <span class="op">=</span> <span class="va">median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, ymin <span class="op">=</span> <span class="va">low</span>, ymax <span class="op">=</span> <span class="va">high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="example-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h3>
<p>We can also fit the model without standardising.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_1</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       mcmc_chains <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, tauL, v, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; conjugate sampler (17)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (1000 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>We can check the fit of the DPMM.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ggpairs.html">plot_ggpairs</a></span><span class="op">(</span><span class="va">posteriors</span>, <span class="va">dataset_1</span>, nburn <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>We then use the same dataset to make prediction from the newly fitted
DPMM.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors.prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_dpmm_fit.html">predict_dpmm_fit</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>                                          newdata <span class="op">=</span> <span class="va">dataset_missing_predict</span>,</span>
<span>                                          samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1500</span>,<span class="fl">2500</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And, once again, check whether the credible intervals are close to
the original values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">low_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">median_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">high_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">low_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">low_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">median_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">median_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">high_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">high_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,<span class="st">"X1"</span><span class="op">]</span>,<span class="va">low_q</span>, <span class="va">median_q</span>,<span class="va">high_q</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observed"</span>, <span class="st">"low"</span>,<span class="st">"median"</span>,<span class="st">"high"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, y <span class="op">=</span> <span class="va">median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, ymin <span class="op">=</span> <span class="va">low</span>, ymax <span class="op">=</span> <span class="va">high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="example-3">Example 3<a class="anchor" aria-label="anchor" href="#example-3"></a>
</h3>
<p>We can also fit the DPMM with missing data present in the original
dataset. Let’s introduce some misisngness in both clusters.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_1</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Then we fit the DPMM whilst standardising values.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       mcmc_chains <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, tauL, v, x_cont_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; conjugate sampler (17)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; conditional_RW sampler (2)</span></span>
<span><span class="co">#&gt;   - x_cont_miss[1, 1:2]</span></span>
<span><span class="co">#&gt;   - x_cont_miss[2, 1:2] </span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (998 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (2 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we can check how well are those missing values being imputed
during the model fitting. Here, we are only checking chain 1, but it can
be repeated for all other chains.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">intercept_1</span> <span class="op">=</span> <span class="op">(</span><span class="va">dataset_1</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">-</span><span class="va">posteriors</span><span class="op">$</span><span class="va">mean_values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">posteriors</span><span class="op">$</span><span class="va">sd_values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">intercept_1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">intercept_2</span> <span class="op">=</span> <span class="op">(</span><span class="va">dataset_1</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">-</span><span class="va">posteriors</span><span class="op">$</span><span class="va">mean_values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">posteriors</span><span class="op">$</span><span class="va">sd_values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[2, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">intercept_2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-17-2.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="example-4">Example 4<a class="anchor" aria-label="anchor" href="#example-4"></a>
</h3>
<p>The same exercise can be done again, but without standardising
continuous values.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       mcmc_chains <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, tauL, v, x_cont_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; conjugate sampler (17)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; conditional_RW sampler (2)</span></span>
<span><span class="co">#&gt;   - x_cont_miss[1, 1:2]</span></span>
<span><span class="co">#&gt;   - x_cont_miss[2, 1:2] </span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (998 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (2 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we check the values imputed.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">dataset_1</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[2, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">dataset_1</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-19-2.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="dataset-2">Dataset 2<a class="anchor" aria-label="anchor" href="#dataset-2"></a>
</h2>
<p>Dataset 2 is comprised of two distinct clusters, where the values of
‘X2’ and ‘X3’ are informative of the cluster membership, but not
‘X1’.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dataset_2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="va">dataset_2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-20-1.png" width="576"></p>
<div class="section level3">
<h3 id="example-1-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1-1"></a>
</h3>
<p>We can fit the DPMM to the complete dataset.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_2</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       mcmc_chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, phiL, tauL, v, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; conjugate sampler (23)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (1000 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>We then check the fit of the DPMM versus the original data.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ggpairs.html">plot_ggpairs</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>             newdata <span class="op">=</span> <span class="va">dataset_2</span>, </span>
<span>             nburn <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-22-1.png" width="576"></p>
<p>We can introduce missingness in the dataset and check whether the
DPMM is predicting values in the right cluster. In this case, we
introduce missingness in ‘X2’ for some of the patients in one of the
clusters.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fl">950</span><span class="op">:</span><span class="fl">1000</span></span>
<span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_2</span></span>
<span><span class="va">dataset_missing_predict</span> <span class="op">&lt;-</span> <span class="va">dataset_missing</span><span class="op">[</span><span class="va">rows</span>,<span class="op">]</span></span>
<span><span class="va">dataset_missing_predict</span><span class="op">[</span>,<span class="st">"X2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p>And make predictions from the fitted DPMM.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors.prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_dpmm_fit.html">predict_dpmm_fit</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>                                          newdata <span class="op">=</span> <span class="va">dataset_missing_predict</span>, </span>
<span>                                          samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1500</span>,<span class="fl">2500</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can then check whether the values are being predicted in the right
place.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">low_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">median_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">high_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">low_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">low_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">median_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">median_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">high_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">high_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We then standardise the original values to match the standardisation
in the DPMM.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">standardised_values</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">dataset_missing</span><span class="op">[</span><span class="va">rows</span>,<span class="st">"X2"</span><span class="op">]</span><span class="op">-</span><span class="va">posteriors</span><span class="op">$</span><span class="va">mean_values</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">posteriors</span><span class="op">$</span><span class="va">sd_values</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>Lastly, we plot the credible intervals against the true values.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">standardised_values</span>,<span class="va">low_q</span>, <span class="va">median_q</span>,<span class="va">high_q</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observed"</span>, <span class="st">"low"</span>,<span class="st">"median"</span>,<span class="st">"high"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, y <span class="op">=</span> <span class="va">median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, ymin <span class="op">=</span> <span class="va">low</span>, ymax <span class="op">=</span> <span class="va">high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="example-2-1">Example 2<a class="anchor" aria-label="anchor" href="#example-2-1"></a>
</h3>
<p>We can do the same exercise but adding missingness to ‘X3’
instead.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fl">950</span><span class="op">:</span><span class="fl">1000</span></span>
<span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_2</span></span>
<span><span class="va">dataset_missing_predict</span> <span class="op">&lt;-</span> <span class="va">dataset_missing</span><span class="op">[</span><span class="va">rows</span>,<span class="op">]</span></span>
<span><span class="va">dataset_missing_predict</span><span class="op">[</span>,<span class="st">"X3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dataset_2</span><span class="op">[</span>,<span class="st">"X3"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And make predictions from the fitted DPMM.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors.prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_dpmm_fit.html">predict_dpmm_fit</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>                                          newdata <span class="op">=</span> <span class="va">dataset_missing_predict</span>, </span>
<span>                                          samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1500</span>,<span class="fl">2500</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can then check whether the values are being predicted in the right
place by plotting a table of the original values versus the predicted
values.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">predicted</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">var</span><span class="op">[</span><span class="va">var</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dataset_2</span><span class="op">[</span><span class="va">rows</span>,<span class="st">"X3"</span><span class="op">]</span>,<span class="va">predicted</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observed"</span>, <span class="st">"predicted"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>observed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>,</span>
<span>         predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         predicted</span></span>
<span><span class="co">#&gt; observed  2</span></span>
<span><span class="co">#&gt;        2 51</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3-1">Example 3<a class="anchor" aria-label="anchor" href="#example-3-1"></a>
</h3>
<p>We can also fit the DPMM with missing data in ‘X3’ present in the
original dataset. Let’s introduce some misisngness in both clusters.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_2</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"X3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Then we fit the DPMM whilst standardising values.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, phiL, tauL, v, x_disc_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; posterior_predictive sampler (2)</span></span>
<span><span class="co">#&gt;   - x_disc_miss[]  (2 elements)</span></span>
<span><span class="co">#&gt; conjugate sampler (23)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (998 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (2 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we can check how well are those missing values being imputed
during the model fitting. Here, we are only checking chain 1, but it can
be repeated for all other chains.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_disc_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">imputed_values</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dataset_2</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"X3"</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1501</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Predicted"</span>,<span class="st">"True"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;          True</span></span>
<span><span class="co">#&gt; Predicted    1</span></span>
<span><span class="co">#&gt;         1 1496</span></span>
<span><span class="co">#&gt;         2    5</span></span>
<span></span>
<span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_disc_miss[2, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">imputed_values</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dataset_2</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X3"</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1501</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Predicted"</span>,<span class="st">"True"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;          True</span></span>
<span><span class="co">#&gt; Predicted    2</span></span>
<span><span class="co">#&gt;         1    3</span></span>
<span><span class="co">#&gt;         2 1498</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-4-1">Example 4<a class="anchor" aria-label="anchor" href="#example-4-1"></a>
</h3>
<p>We can also fit the DPMM with missing data in “X2” present in the
original dataset. Let’s introduce some misisngness in both clusters.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_2</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Then we fit the DPMM whilst standardising values.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, phiL, tauL, v, x_cont_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; conjugate sampler (23)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; conditional_RW sampler (2)</span></span>
<span><span class="co">#&gt;   - x_cont_miss[1, 1:2]</span></span>
<span><span class="co">#&gt;   - x_cont_miss[2, 1:2] </span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (998 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (2 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we can check how well are those missing values being imputed
during the model fitting. Here, we are only checking chain 1, but it can
be repeated for all other chains.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 2]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">imputed_values</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">dataset_2</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X2"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-36-1.png" width="576"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[2, 2]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">imputed_values</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">dataset_2</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X2"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-36-2.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="example-5">Example 5<a class="anchor" aria-label="anchor" href="#example-5"></a>
</h3>
<p>We can also fit the DPMM with missing data in “X1” and “X2” present
in the original dataset. Let’s introduce some misisngness in both
clusters.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_2</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">501</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Then we fit the DPMM whilst standardising values.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, phiL, tauL, v, x_cont_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; posterior_predictive sampler (2)</span></span>
<span><span class="co">#&gt;   - x_cont_miss[1, 1:2]</span></span>
<span><span class="co">#&gt;   - x_cont_miss[2, 1:2] </span></span>
<span><span class="co">#&gt; conjugate sampler (23)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (998 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (2 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we can check how well are those missing values being imputed
during the model fitting. Here, we are only checking chain 1, but it can
be repeated for all other chains.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 y <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 2]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"darkorange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dataset_2</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">dataset_2</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X2"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>             colour <span class="op">=</span> <span class="st">"darkorange3"</span>, </span>
<span>             fill <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[2, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 y <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[2, 2]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dataset_2</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X1"</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">dataset_2</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X2"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>             colour <span class="op">=</span> <span class="st">"royalblue4"</span>, </span>
<span>             fill <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-39-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="dataset-3">Dataset 3<a class="anchor" aria-label="anchor" href="#dataset-3"></a>
</h2>
<p>Dataset 3 is comprised of two distinct clusters, where the values of
‘X1’ and ‘X2’ are informative of the cluster membership.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dataset_3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="va">dataset_3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-40-1.png" width="576"></p>
<div class="section level3">
<h3 id="example-1-2">Example 1<a class="anchor" aria-label="anchor" href="#example-1-2"></a>
</h3>
<p>We can fit the DPMM to the complete dataset.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_3</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       mcmc_chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, phiL, v, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW sampler (1)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt; conjugate sampler (17)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (12 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (1000 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>We then check the fit of the DPMM versus the original data.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## PROBLEM HERE</span></span>
<span><span class="fu"><a href="../reference/plot_ggpairs.html">plot_ggpairs</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>             newdata <span class="op">=</span> <span class="va">dataset_3</span>, </span>
<span>             nburn <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-42-1.png" width="576"></p>
<p>We can introduce missingness in the dataset and check whether the
DPMM is predicting values in the right cluster. In this case, we
introduce missingness in ‘X2’ for some of the patients in one of the
clusters.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fl">950</span><span class="op">:</span><span class="fl">1000</span></span>
<span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_3</span></span>
<span><span class="va">dataset_missing_predict</span> <span class="op">&lt;-</span> <span class="va">dataset_missing</span><span class="op">[</span><span class="va">rows</span>,<span class="op">]</span></span>
<span><span class="va">dataset_missing_predict</span><span class="op">[</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dataset_3</span><span class="op">[</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And make predictions from the fitted DPMM.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors.prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_dpmm_fit.html">predict_dpmm_fit</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>                                          newdata <span class="op">=</span> <span class="va">dataset_missing_predict</span>, </span>
<span>                                          samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1500</span>,<span class="fl">2500</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can then check whether the values are being predicted in the right
place.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">predicted</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">var</span><span class="op">[</span><span class="va">var</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dataset_3</span><span class="op">[</span><span class="va">rows</span>,<span class="st">"X1"</span><span class="op">]</span>,<span class="va">predicted</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observed"</span>, <span class="st">"predicted"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>observed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>,</span>
<span>         predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         predicted</span></span>
<span><span class="co">#&gt; observed  2</span></span>
<span><span class="co">#&gt;        2 51</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2-2"></a>
</h3>
<p>We can also fit the DPMM with missing data in “X1” present in the
original dataset. Let’s introduce some misisngness in both clusters.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_3</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dataset_3</span><span class="op">[</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dataset_3</span><span class="op">[</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we fit the DPMM whilst standardising values.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, phiL, v, x_disc_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW sampler (1)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt; posterior_predictive sampler (2)</span></span>
<span><span class="co">#&gt;   - x_disc_miss[]  (2 elements)</span></span>
<span><span class="co">#&gt; conjugate sampler (17)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (12 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (998 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (2 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we can check how well are those missing values being imputed
during the model fitting. Here, we are only checking chain 1, but it can
be repeated for all other chains.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_disc_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">imputed_values</span>, <span class="va">dataset_3</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prediction"</span>,<span class="st">"True Value"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;           True Value</span></span>
<span><span class="co">#&gt; Prediction    1</span></span>
<span><span class="co">#&gt;          1 1496</span></span>
<span><span class="co">#&gt;          2    5</span></span>
<span></span>
<span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_disc_miss[2, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">imputed_values</span>, <span class="va">dataset_3</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prediction"</span>,<span class="st">"True Value"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;           True Value</span></span>
<span><span class="co">#&gt; Prediction    2</span></span>
<span><span class="co">#&gt;          1    8</span></span>
<span><span class="co">#&gt;          2 1493</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="dataset-4">Dataset 4<a class="anchor" aria-label="anchor" href="#dataset-4"></a>
</h2>
<p>Dataset 4 is comprised of a ‘Y’ outcome variable, ‘X1’/‘X2’/‘X3’
continuous predictors and ‘X4’ categorical predictor.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dataset_4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="va">dataset_4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-49-1.png" width="576"></p>
<div class="section level3">
<h3 id="example-1-3">Example 1<a class="anchor" aria-label="anchor" href="#example-1-3"></a>
</h3>
<p>We can fit the DPMM to the complete dataset.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_4</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, phiL, tauL, v, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:4, 1:4] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; conjugate sampler (23)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (500)</span></span>
<span><span class="co">#&gt;   - z[]  (500 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>We then check the fit of the DPMM versus the original data.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ggpairs.html">plot_ggpairs</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>             newdata <span class="op">=</span> <span class="va">dataset_4</span>, </span>
<span>             nburn <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-51-1.png" width="576"></p>
<p>We can introduce missingness in the dataset and check whether the
DPMM is predicting values correctly. In this case, we introduce
missingness in ‘Y’ for 100 random patients.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dataset_4</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_4</span></span>
<span><span class="va">dataset_missing_predict</span> <span class="op">&lt;-</span> <span class="va">dataset_missing</span><span class="op">[</span><span class="va">rows</span>,<span class="op">]</span></span>
<span><span class="va">dataset_missing_predict</span><span class="op">[</span>,<span class="st">"Y"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p>And make predictions from the fitted DPMM.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors.prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_dpmm_fit.html">predict_dpmm_fit</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>                                          <span class="va">dataset_missing_predict</span>, </span>
<span>                                          samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1500</span>,<span class="fl">2500</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can then check whether the values are being predicted in the right
place.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">low_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">median_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">high_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">low_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">low_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">median_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">median_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">high_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">high_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dataset_4</span><span class="op">[</span><span class="va">rows</span>,<span class="st">"Y"</span><span class="op">]</span>,<span class="va">low_q</span>, <span class="va">median_q</span>,<span class="va">high_q</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observed"</span>, <span class="st">"low"</span>,<span class="st">"median"</span>,<span class="st">"high"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, y <span class="op">=</span> <span class="va">median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, ymin <span class="op">=</span> <span class="va">low</span>, ymax <span class="op">=</span> <span class="va">high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-54-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="dataset-5">Dataset 5<a class="anchor" aria-label="anchor" href="#dataset-5"></a>
</h2>
<p>Dataset 5 is comprised of two distinct clusters, where the values of
‘X1’ overlap for both clusters, ‘X2’ values do not overlap, ‘X3’ is
categorical and distinct between both clusters, and ‘X4’ is categorical
with fours levels and each cluster has two levels. ‘X2’/‘X3’/‘X4’ are
informative of the cluster membership.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-55-1.png" width="576"></p>
<div class="section level3">
<h3 id="example-1-4">Example 1<a class="anchor" aria-label="anchor" href="#example-1-4"></a>
</h3>
<p>We can fit the DPMM with missing data in “X1”/“X3” present in the
original dataset. Let’s introduce some misisngness in both clusters.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_5</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"X3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">[</span>,<span class="st">"X3"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we fit the DPMM whilst standardising values.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       mcmc_chains <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, phiL, tauL, v, x_cont_miss, x_disc_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; posterior_predictive sampler (1)</span></span>
<span><span class="co">#&gt;   - x_disc_miss[]  (1 element)</span></span>
<span><span class="co">#&gt; conjugate sampler (29)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (12 multivariate elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; conditional_RW sampler (1)</span></span>
<span><span class="co">#&gt;   - x_cont_miss[1, 1:2] </span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (998 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (2 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we can check how well are those missing values being imputed
during the model fitting. Here, we are only checking chain 1, but it can
be repeated for all other chains.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">imputed_values</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">dataset_5</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-58-1.png" width="576"></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_disc_miss[2, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">imputed_values</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"X3"</span><span class="op">]</span>, rep <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Predicted"</span>,<span class="st">"True"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;          True</span></span>
<span><span class="co">#&gt; Predicted    1</span></span>
<span><span class="co">#&gt;         1 1500</span></span>
<span><span class="co">#&gt;         2    1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2-3">Example 2<a class="anchor" aria-label="anchor" href="#example-2-3"></a>
</h3>
<p>We can fit the DPMM with missing data in ‘X1’/‘X2’/‘X3’ present in
the original dataset. Let’s introduce some misisngness in both
clusters.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_5</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">[</span>,<span class="st">"X3"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we fit the DPMM whilst standardising values.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, phiL, tauL, v, x_cont_miss, x_disc_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; posterior_predictive sampler (2)</span></span>
<span><span class="co">#&gt;   - x_disc_miss[]  (1 element)</span></span>
<span><span class="co">#&gt;   - x_cont_miss[1, 1:2] </span></span>
<span><span class="co">#&gt; conjugate sampler (29)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (12 multivariate elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (999 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (1 element)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we can check how well are those missing values being imputed
during the model fitting. Here, we are only checking chain 1, but it can
be repeated for all other chains.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_values_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">imputed_values_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 2]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">imputed_values_1</span>, y <span class="op">=</span> <span class="va">imputed_values_2</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dataset_5</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">dataset_5</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X2"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-61-1.png" width="576"></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Table predicted values vs observed values</span></span>
<span><span class="co"># Note: Variable X3 is well explained by X4</span></span>
<span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_disc_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">imputed_values</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X3"</span><span class="op">]</span>, rep <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Predicted"</span>,<span class="st">"True"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;          True</span></span>
<span><span class="co">#&gt; Predicted    1</span></span>
<span><span class="co">#&gt;         1 1490</span></span>
<span><span class="co">#&gt;         2   11</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3-2">Example 3<a class="anchor" aria-label="anchor" href="#example-3-2"></a>
</h3>
<p>We can fit the DPMM with missing data in ‘X1’/‘X3’/‘X4’ present in
the original dataset. Let’s introduce some misisngness in both
clusters.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_5</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">[</span>,<span class="st">"X3"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X4"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">[</span>,<span class="st">"X4"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we fit the DPMM whilst standardising values.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, phiL, tauL, v, x_cont_miss, x_disc_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; posterior_predictive sampler (2)</span></span>
<span><span class="co">#&gt;   - x_disc_miss[]  (2 elements)</span></span>
<span><span class="co">#&gt; conjugate sampler (29)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - phiL[]  (12 multivariate elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; conditional_RW sampler (1)</span></span>
<span><span class="co">#&gt;   - x_cont_miss[1, 1:2] </span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (999 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (1 element)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we can check how well are those missing values being imputed
during the model fitting. Here, we are only checking chain 1, but it can
be repeated for all other chains. First we check ‘X3’, which is well
explained by ‘X2’.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_disc_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">imputed_values</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X3"</span><span class="op">]</span>, rep <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Predicted"</span>,<span class="st">"True"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;          True</span></span>
<span><span class="co">#&gt; Predicted    1</span></span>
<span><span class="co">#&gt;         1 1497</span></span>
<span><span class="co">#&gt;         2    4</span></span></code></pre></div>
<p>Then we check ‘X4’, which is well explained by ‘X2’ but should have
two categories.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_disc_miss[1, 2]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">imputed_values</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">dataset_5</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X4"</span><span class="op">]</span>, rep <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Predicted"</span>,<span class="st">"True"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;          True</span></span>
<span><span class="co">#&gt; Predicted   1</span></span>
<span><span class="co">#&gt;         1 792</span></span>
<span><span class="co">#&gt;         2 707</span></span>
<span><span class="co">#&gt;         4   2</span></span></code></pre></div>
<p>Then we check ‘X1’, which is well explained by ‘X2’.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">imputed_values</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">dataset_5</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-66-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="dataset-6">Dataset 6<a class="anchor" aria-label="anchor" href="#dataset-6"></a>
</h2>
<p>Dataset 5 is comprised of two distinct clusters, where the values of
both predictors do not overlap each other. The clusters are defined so
that they have a specific shape.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dataset_6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="va">dataset_6</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-67-1.png" width="576"></p>
<div class="section level3">
<h3 id="example-1-5">Example 1<a class="anchor" aria-label="anchor" href="#example-1-5"></a>
</h3>
<p>We can fit the DPMM to the complete dataset.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_6</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, tauL, v, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; conjugate sampler (17)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (1000 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>We then check the fit of the DPMM versus the original data.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ggpairs.html">plot_ggpairs</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>             newdata <span class="op">=</span> <span class="va">dataset_6</span>, </span>
<span>             nburn <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-69-1.png" width="576"></p>
<p>We can introduce missingness in the dataset and check whether the
DPMM is predicting values correctly. In this case, we introduce
missingness in ‘Y’ for 100 random patients.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span></span>
<span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_6</span></span>
<span><span class="va">dataset_missing_predict</span> <span class="op">&lt;-</span> <span class="va">dataset_missing</span><span class="op">[</span><span class="va">rows</span>,<span class="op">]</span></span>
<span><span class="va">dataset_missing_predict</span><span class="op">[</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p>And make predictions from the fitted DPMM.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors.prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_dpmm_fit.html">predict_dpmm_fit</a></span><span class="op">(</span><span class="va">posteriors</span>, </span>
<span>                                          <span class="va">dataset_missing_predict</span>, </span>
<span>                                          samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1500</span>,<span class="fl">2500</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can then check whether the values are being predicted in the right
place.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">low_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">median_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">high_q</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">low_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">low_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">median_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">median_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">high_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">high_q</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">posteriors.prediction</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dataset_6</span><span class="op">[</span><span class="va">rows</span>,<span class="st">"X1"</span><span class="op">]</span>,<span class="va">low_q</span>, <span class="va">median_q</span>,<span class="va">high_q</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observed"</span>, <span class="st">"low"</span>,<span class="st">"median"</span>,<span class="st">"high"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, y <span class="op">=</span> <span class="va">median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, ymin <span class="op">=</span> <span class="va">low</span>, ymax <span class="op">=</span> <span class="va">high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-72-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="example-2-4">Example 2<a class="anchor" aria-label="anchor" href="#example-2-4"></a>
</h3>
<p>We can fit the DPMM with missing data in ‘X1’ present in the original
dataset. Let’s introduce some misisngness in both clusters.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_missing</span> <span class="op">&lt;-</span> <span class="va">dataset_6</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">dataset_missing</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Then we fit the DPMM whilst standardising values.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runModel.html">runModel</a></span><span class="op">(</span><span class="va">dataset_missing</span>, </span>
<span>                       mcmc_iterations <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                       L <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                       standardise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== Monitors =====</span></span>
<span><span class="co">#&gt; thin = 1: alpha, muL, tauL, v, x_cont_miss, z</span></span>
<span><span class="co">#&gt; ===== Samplers =====</span></span>
<span><span class="co">#&gt; RW_wishart sampler (1)</span></span>
<span><span class="co">#&gt;   - R1[1:2, 1:2] </span></span>
<span><span class="co">#&gt; RW sampler (2)</span></span>
<span><span class="co">#&gt;   - alpha</span></span>
<span><span class="co">#&gt;   - kappa1</span></span>
<span><span class="co">#&gt; conjugate sampler (17)</span></span>
<span><span class="co">#&gt;   - v[]  (5 elements)</span></span>
<span><span class="co">#&gt;   - muL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt;   - tauL[]  (6 multivariate elements)</span></span>
<span><span class="co">#&gt; conditional_RW sampler (2)</span></span>
<span><span class="co">#&gt;   - x_cont_miss[1, 1:2]</span></span>
<span><span class="co">#&gt;   - x_cont_miss[2, 1:2] </span></span>
<span><span class="co">#&gt; categorical sampler (1000)</span></span>
<span><span class="co">#&gt;   - z[]  (998 elements)</span></span>
<span><span class="co">#&gt;   - zmiss[]  (2 elements)</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span>
<span><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></span>
<span><span class="co">#&gt; |-------------------------------------------------------|</span></span></code></pre></div>
<p>And we can check how well are those missing values being imputed
during the model fitting. Here, we are only checking chain 1, but it can
be repeated for all other chains.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[1, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">imputed_values</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">dataset_6</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-75-1.png" width="576"></p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">posteriors</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">chain1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`x_cont_miss[2, 1]`</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2500</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">imputed_values</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">dataset_6</span><span class="op">[</span><span class="fl">501</span>,<span class="st">"X1"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Worked_Examples_files/figure-html/unnamed-chunk-75-2.png" width="576"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Pedro Cardoso, TJ McKinley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
